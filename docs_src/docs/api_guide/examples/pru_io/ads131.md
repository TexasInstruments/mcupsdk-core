# ADS131 {#EXAMPLES_PRU_ADC_ADS131}

[TOC]

## Introduction

This example uses [ADS131M08](https://www.ti.com/product/ADS131M08) ADC IC to convert analog input signal on adc channel to samples and store the results in a shared memory which can be configured by the user (using \ref DRIVERS_PRU_IPC module). The read samples are finally printed to the R5F console, or can also be visualized using CCS Graph plotter. GUI Composer app available on TI Gallery can also be used to evaluate the ADC using a GUI based interface.

The example does the below
- PRU controls the ADC and reads the samples
- PRU program implements ADC samples transfer interface
- PRU then writes the samples to a shared memory and creates an interrupt after writing 1 block of data
- On interrupt R5F then reads the data and prints it on console

# Supported Combinations {#EXAMPLES_PRU_ADC_ADS131_DEMO_COMBOS}

\cond SOC_AM64X || SOC_AM243X

 Parameter      | Value
 ---------------|-----------
 CPU + OS       | r5fss0-0 freertos
 ICSSG          | ICSSG0 - PRU0
 Toolchain      | ti-arm-clang, pru-cgt
 Board          | @VAR_BOARD_NAME_LOWER
 Example folder | examples/pru_io/adc/ADS131/

\endcond

# Steps to Run the Example

- Setup:  The ADC EVM is connected to AM64x/AM243x GP EVM using [ADC-PHI-PRU-EVM Adapter Board](https://www.ti.com/tool/ADC-PHI-PRU-EVM) inbetween.

    \imageStyle{ADS131-setup.png,width:32%}
    \image html ADS131-setup.png " "

- **When using CCS projects to build**, import the CCS project from the above mentioned Example folder path for R5F (It will automatically import PRU project) for the required combination.

- On importing the project, SysConfig will contain an ADC Config instance with default configurations which are compatible with the T&M SEM Adapter Board. Use SysConfig to configure the required settings for the ADC IC.

    \imageStyle{ads131_syscfg.png,width:60%}
    \image html ads131_syscfg.png "ADC SysConfig Options"
    \par
    You will need to edit linker file whenever changes are made to the configuration for \ref DRIVERS_PRU_IPC module, refer \ref DRIVERS_PRU_IPC_LINKER

- Build only the R5F project using the CCS project menu (see \ref CCS_PROJECTS_PAGE).
     - Build Flow: Once you click on build in R5F project, first, SysConfig files are generated, then the PRU project is compiled according to the configurations set in SysConfig. Finally the R5F project will be generated using both the generated SysConfig and PRU project binaries.
     - Note: The PRU project won't build independently as it is dependent on SysConfig files generated by the R5F project.

    \note
    Prerequisite: [PRU-CGT-2-3](https://www.ti.com/tool/PRU-CGT) (ti-pru-cgt) should be installed at: `C:/ti/`

- Launch a CCS debug session and run the executable, see \ref CCS_LAUNCH_PAGE

## Features

Supported:

- Serial Interface
- Interrupt on receiving a block of data
- ADC, Pinmux and other configurations through SysConfig interface

# Important files and directory structure

<table>
<tr>
    <th>Folder/Files
    <th>Description
</tr>
<tr><td colspan="2" bgcolor=#F0F0F0> ${SDK_INSTALL_PATH}/source/pru_io/</td></tr>
<tr>
    <td>firmware/
    <td>PRU source files providing macros for interfaces, pru_ipc, etc.</td>
</tr>
<tr>
    <td>driver/
    <td>PRU IPC source files for sending ADC samples from PRU to R5F</td>
</tr>
</table>

# Sample Output

Shown below is a sample output when the application is run:

\code
--------------------------------------------------
Initializing App 
Initialized 
--------------------------------------------------
Powering up ADC... 
ADC Powered Up 
--------------------------------------------------
Resetting ADC 
--------------------------------------------------
Configuring ADC... 
ADC Configuration completed 
--------------------------------------------------
Starting ADC Conversion 
Started ADC Conversion 
--------------------------------------------------
----- Channel: 1 ----- 
Sample 1:  1858  
Sample 2:  1552  
Sample 3:  2037  
Sample 4:  1752  
Sample 5:  2005  
----- Channel: 2 ----- 
Sample 1:  1214  
Sample 2:  1372  
Sample 3:  1256  
Sample 4:  1425  
Sample 5:  1034 

\endcode

# Implementation Details

Refer here for complete implementation explanation: \subpage EXAMPLES_PRU_ADC_ADS131_DETAILS
