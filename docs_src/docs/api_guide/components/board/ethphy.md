# ETHPHY {#BOARD_ETHPHY_PAGE}

[TOC]

The ETHPHY driver provides APIs to control the Ethernet PHY devices present on
the board. It accesses the PHY registers using the MDIO module.

## Features Supported

\note Only the commands needed for Industial Protocol examples are supported

- Commands for following things:
    - Get the PHY link status
    - Set/get speed and half-duplex/full-duplex configuration
    - Configure PHY LEDs
    - Select MII mode
    - Soft-restart PHY
    - Enable Auto MDI-X
    - Disable 1G Advertisement
    - Get auto-negotiation status
    - Get auto-negotiation capability of link partner
    - Configure features like fast link down detection, extended full duplex ability, odd nibble detection and enhanced IPG detection
    - Set Tx/Rx FIFO Half Full Threshold for RGMII mode

## SysConfig Features

@VAR_SYSCFG_USAGE_NOTE

- Option to select the type of Ethernet PHY
    - Supported PHYs
\cond SOC_AM64X || SOC_AM243X
        - DP83869
        - CUSTOM
        - NONE
\endcond
\cond SOC_AM263X || SOC_AM263PX || SOC_AM261X
        - DP83869
        - DP83826E
        - CUSTOM
        - NONE
\endcond
- Option to select the MDIO instance to which PHY is connected
- Option to set the PHY address

- Based on above parameters, the SysConfig generated code does following:
    - Open the ETHPHY instance using \ref ETHPHY_open API as a part of Board_driversOpen. Handle can used by including `"ti_board_open_close.h"` file.
    - Close the ETHPHY instance as a part of Board_driversClose
    - Create macros like `CONFIG_ETHPHY0` using the name passed in SysConfig. This is used as an index to the array of handles.

## Example Usage

Include the below file to access the APIs
\snippet Ethphy_sample.c include

Selecting MII mode and soft-resetting the PHY
\snippet Ethphy_sample.c ethphy_sample_1

Configuring PHY LED sources
\snippet Ethphy_sample.c ethphy_sample_2

## Adding Support for Custom PHY

In the SysConfig for ETHPHY, there are following options apart from the Ethernet PHYs supported in the SDK :

1. CUSTOM : Generate SysConfig code with a custom PHY name. `extern ETHPHY_Fxns gEthPhyFxns_MyEthPhyDevice;` will be added in the `ti_board_open_close.c` file generated by SysConfig. Hence \ref ETHPHY_Fxns should be defined for the custom PHY. Essentially one needs to write code similar to a supported PHY device (For an example, see `${SDK_INSTALL_PATH}/source/board/ethphy/ethphy_dp83869.c`). \ref BOARD_ETHPHY_MODULE can be used directly in this case.

2. NONE : SysConfig does not generate any code for ETHPHY. Modules like EtherCAT and Ethernet (ICSS) add instances of ETHPHY in SysConfig. This option can be used if the PHY implementation is custom, and you do not want any code to be generated from SysConfig. \ref BOARD_ETHPHY_MODULE can not be used directly in this case.

## API

\ref BOARD_ETHPHY_MODULE