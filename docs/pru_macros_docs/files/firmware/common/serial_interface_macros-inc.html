<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>serial_interface_macros.inc</title><link rel="stylesheet" type="text/css" href="../../../styles/main.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="serial_interface_macros.inc"></a><a name="Topic204"></a><div class="CTopic TFile LAssembly first">
 <div class="CTitle">serial_interface_macros.inc</div>
 <div class="CBody"><p>Brief:&nbsp; Serial Interface related macro definitions</p><div class="CHeading">Includes</div><p>icss_pin_macros.inc time_macros.inc</p></div>
</div>

<a name="Macros"></a><a name="Topic20"></a><div class="CTopic TGroup LAssembly">
 <div class="CTitle">Macros</div>
</div>

<a name="m_read_packet_spi_mode1_msb_gpo_sclk"></a><a name="Topic205"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_read_packet_spi_mode1_msb_gpo_sclk</div>
 <div class="CBody"><p>Read 1 data packet from the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>To store read serial data packet</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SCLK_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SCLK</p></td></tr><tr><td class="CDLEntry">SDI_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDI</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is high</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is low</p></td></tr></table></div>
</div>

<a name="m_read_packet_spi_mode1_lsb_gpo_sclk"></a><a name="Topic206"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_read_packet_spi_mode1_lsb_gpo_sclk</div>
 <div class="CBody"><p>Read 1 data packet from the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>To store read serial data packet</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SCLK_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SCLK</p></td></tr><tr><td class="CDLEntry">SDI_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDI</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is high</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is low</p></td></tr></table></div>
</div>

<a name="m_read_packet_spi_mode1_msb_iep_sclk"></a><a name="Topic207"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_read_packet_spi_mode1_msb_iep_sclk</div>
 <div class="CBody"><p>Read 1 data packet from the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>To store read serial data packet</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SDI_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDI</p></td></tr><tr><td class="CDLEntry">temp_reg</td><td class="CDLDefinition"><p>temporary register</p></td></tr><tr><td class="CDLEntry">IEP_INST</td><td class="CDLDefinition"><p>IEP Instance being used for SCLK</p></td></tr><tr><td class="CDLEntry">SYNC_SIGNAL</td><td class="CDLDefinition"><p>IEP Sync out signal being used for SCLK</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for before reading PRU pins</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for to sync with SCLK period</p></td></tr></table></div>
</div>

<a name="m_read_packet_spi_mode1_lsb_iep_sclk"></a><a name="Topic208"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_read_packet_spi_mode1_lsb_iep_sclk</div>
 <div class="CBody"><p>Read 1 data packet from the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>To store read serial data packet</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SDI_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDI</p></td></tr><tr><td class="CDLEntry">temp_reg</td><td class="CDLDefinition"><p>temporary register</p></td></tr><tr><td class="CDLEntry">IEP_INST</td><td class="CDLDefinition"><p>IEP Instance being used for SCLK</p></td></tr><tr><td class="CDLEntry">SYNC_SIGNAL</td><td class="CDLDefinition"><p>IEP Sync out signal being used for SCLK</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for before reading PRU pins</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for to sync with SCLK period</p></td></tr></table></div>
</div>

<a name="m_send_packet_spi_mode1_msb_gpo_sclk"></a><a name="Topic209"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_send_packet_spi_mode1_msb_gpo_sclk</div>
 <div class="CBody"><p>Send 1 data packet through the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>Contains data packet to send</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SCLK_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SCLK</p></td></tr><tr><td class="CDLEntry">SDO_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDO</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is high</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is low</p></td></tr></table></div>
</div>

<a name="m_send_packet_spi_mode1_lsb_gpo_sclk"></a><a name="Topic210"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_send_packet_spi_mode1_lsb_gpo_sclk</div>
 <div class="CBody"><p>Send 1 data packet through the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>Contains data packet to send</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SCLK_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SCLK</p></td></tr><tr><td class="CDLEntry">SDO_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDO</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is high</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for while SCLK is low</p></td></tr></table></div>
</div>

<a name="m_send_packet_spi_mode1_msb_iep_sclk"></a><a name="Topic211"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_send_packet_spi_mode1_msb_iep_sclk</div>
 <div class="CBody"><p>Send 1 data packet through the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>Contains data packet to send</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SDO_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDO</p></td></tr><tr><td class="CDLEntry">temp_reg</td><td class="CDLDefinition"><p>temporary register</p></td></tr><tr><td class="CDLEntry">IEP_INST</td><td class="CDLDefinition"><p>IEP Instance being used for SCLK</p></td></tr><tr><td class="CDLEntry">SYNC_SIGNAL</td><td class="CDLDefinition"><p>IEP Sync out signal being used for SCLK</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for before sending data, to sync with IEP signal</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for to sync with SCLK period</p></td></tr></table></div>
</div>

<a name="m_send_packet_spi_mode1_lsb_iep_sclk"></a><a name="Topic212"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_send_packet_spi_mode1_lsb_iep_sclk</div>
 <div class="CBody"><p>Send 1 data packet through the SPI interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>Contains data packet to send</p></td></tr><tr><td class="CDLEntry">PACKETSIZE</td><td class="CDLDefinition"><p>Size of data packet in bits</p></td></tr><tr><td class="CDLEntry">bitId</td><td class="CDLDefinition"><p>To track Bit index (8 bits wide)</p></td></tr><tr><td class="CDLEntry">SDO_PIN</td><td class="CDLDefinition"><p>PRU Pin number for SDO</p></td></tr><tr><td class="CDLEntry">temp_reg</td><td class="CDLDefinition"><p>temporary register</p></td></tr><tr><td class="CDLEntry">IEP_INST</td><td class="CDLDefinition"><p>IEP Instance being used for SCLK</p></td></tr><tr><td class="CDLEntry">SYNC_SIGNAL</td><td class="CDLDefinition"><p>IEP Sync out signal being used for SCLK</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_1</td><td class="CDLDefinition"><p>PRU cycles to wait for before sending data, to sync with IEP SCLK signal</p></td></tr><tr><td class="CDLEntry">DELAY_COMPEN_2</td><td class="CDLDefinition"><p>PRU cycles to wait for to sync with SCLK period</p></td></tr></table></div>
</div>

<a name="m_send_packet_spi"></a><a name="Topic234"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_send_packet_spi</div>
 <div class="CBody"><p>Send 1 data packet through the serial interface.</p><pre>SPI Mode | CPOL | CPHA |  Idle State Clock Polarity | Clock Phase Used to Sample and/or Shift the Data<br />   0     |  0   |  0   |       Logic low            | Data sampled on rising edge and shifted out on the falling edge<br />   1     |  0   |  1   |       Logic low            | Data sampled on the falling edge and shifted out on the rising edge<br />   2     |  1   |  0   |       Logic high           | Data sampled on the rising edge and shifted out on the falling edge<br />   3     |  1   |  1   |       Logic high           | Data sampled on the falling edge and shifted out on the rising edge</pre><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>Contains data packet to send</p></td></tr><tr><td class="CDLEntry">MODE</td><td class="CDLDefinition"><p>SPI MODE: MODE0, MODE1, MODE2, MODE3</p></td></tr><tr><td class="CDLEntry">ENDIAN</td><td class="CDLDefinition"><p>MSB: MSB First, LSB: LSB First</p></td></tr><tr><td class="CDLEntry">SCLK_TRGR</td><td class="CDLDefinition"><p>IEP_SYNC: Use IEP Sync_out for SCLK, BIT_BANG: Drive PRU GPO using R30</p></td></tr><tr><td class="CDLEntry">CONFIG</td><td class="CDLDefinition"><p>Dependent on the invoked macro</p></td></tr></table></div>
</div>

<a name="m_read_packet_spi"></a><a name="Topic235"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_read_packet_spi</div>
 <div class="CBody"><p>Read 1 data packet through the serial interface.</p><pre>SPI Mode | CPOL | CPHA |  Idle State Clock Polarity | Clock Phase Used to Sample and/or Shift the Data<br />   0     |  0   |  0   |       Logic low            | Data sampled on rising edge and shifted out on the falling edge<br />   1     |  0   |  1   |       Logic low            | Data sampled on the falling edge and shifted out on the rising edge<br />   2     |  1   |  0   |       Logic high           | Data sampled on the rising edge and shifted out on the falling edge<br />   3     |  1   |  1   |       Logic high           | Data sampled on the falling edge and shifted out on the rising edge</pre><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dataReg</td><td class="CDLDefinition"><p>To store read data packet</p></td></tr><tr><td class="CDLEntry">MODE</td><td class="CDLDefinition"><p>SPI MODE: MODE0, MODE1, MODE2, MODE3</p></td></tr><tr><td class="CDLEntry">ENDIAN</td><td class="CDLDefinition"><p>MSB: MSB First, LSB: LSB First</p></td></tr><tr><td class="CDLEntry">SCLK_TRGR</td><td class="CDLDefinition"><p>IEP_SYNC: Use IEP Sync_out for SCLK, BIT_BANG: Drive PRU GPO using R30</p></td></tr><tr><td class="CDLEntry">CONFIG</td><td class="CDLDefinition"><p>Dependent on the invoked macro</p></td></tr></table></div>
</div>

<a name="m_read_frame_spi"></a><a name="Topic215"></a><div class="CTopic TMacro LAssembly last">
 <div class="CTitle">m_read_frame_spi</div>
 <div class="CBody"><p>Read 1 data packet from the serial interface.</p><p>PEAK cycles: ~ cycle</p><p>Pseudo code:</p><pre>dataReg = <span class="SHNumber">0</span><br />bitId = PACKETSIZE - <span class="SHNumber">1</span><br />loop:   READ_PACKET<br />    <span class="SHKeyword">set</span>   SCLK_PIN<br />    wait  <span class="SHNumber">16</span> cycles<br />    clear SCLK_PIN</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">NO_OF_PACKETS</td><td class="CDLDefinition"><p>Number of data packets per frame</p></td></tr><tr><td class="CDLEntry">WAIT_CSRD</td><td class="CDLDefinition"><p>Delay required between CS and SCLK trigger</p></td></tr><tr><td class="CDLEntry">tempDataReg</td><td class="CDLDefinition"><p>To store read serial data packet temporarily</p></td></tr><tr><td class="CDLEntry">packetId</td><td class="CDLDefinition"><p>To track Packet indices (8 bits wide)</p></td></tr><tr><td class="CDLEntry">dataRegBaseAddr</td><td class="CDLDefinition"><p>(8 bits) Address of starting data register =&gt; register R1.bx must be used</p></td></tr><tr><td class="CDLEntry">CONFIG</td><td class="CDLDefinition"><p>Dependent on the invoked macro</p></td></tr></table></div>
</div>

</body></html>