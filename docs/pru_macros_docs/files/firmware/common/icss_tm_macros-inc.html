<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>icss_tm_macros.inc</title><link rel="stylesheet" type="text/css" href="../../../styles/main.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="icss_tm_macros.inc"></a><a name="Topic3"></a><div class="CTopic TFile LAssembly first">
 <div class="CTitle">icss_tm_macros.inc</div>
 <div class="CBody"><p>brief:&nbsp; PRU Task Manager Related Macro definitions</p></div>
</div>

<a name="Macros"></a><a name="Topic23"></a><div class="CTopic TGroup LAssembly">
 <div class="CTitle">Macros</div>
</div>

<a name="m_pru_tasks_mgr_global_cfg_reg"></a><a name="Topic24"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tasks_mgr_global_cfg_reg</div>
 <div class="CBody"><p>Set value of tasks_mgr_global_cfg_reg.&nbsp; Subtasks:&nbsp; 0: Disabled&nbsp; 1: Enabled Bit&nbsp; | Field&nbsp; | Type | Reset | Description 11&nbsp; | TS2_EN_S4&nbsp; | R/W&nbsp; | 0h&nbsp; | TS2 Sub4 10&nbsp; | TS2_EN_S3&nbsp; | R/W&nbsp; | 0h&nbsp; | TS2 Sub3 9&nbsp; | TS2_EN_S2&nbsp; | R/W&nbsp; | 0h&nbsp; | TS2 Sub2 8&nbsp; | TS2_EN_S1&nbsp; | R/W&nbsp; | 0h&nbsp; | TS2 Sub1 7&nbsp; | TS2_EN_S0&nbsp; | R/W&nbsp; | 0h&nbsp; | TS2 Sub0 6&nbsp; | TS1_EN_S4&nbsp; | R/W&nbsp; | 0h&nbsp; | TS1 Sub4 5&nbsp; | TS1_EN_S3&nbsp; | R/W&nbsp; | 0h&nbsp; | TS1 Sub3 4&nbsp; | TS1_EN_S2&nbsp; | R/W&nbsp; | 0h&nbsp; | TS1 Sub2 3&nbsp; | TS1_EN_S1&nbsp; | R/W&nbsp; | 0h&nbsp; | TS1 Sub1 2&nbsp; | TS1_EN_S0&nbsp; | R/W&nbsp; | 0h&nbsp; | TS1 Sub0 1-0&nbsp; | TASKS_MGR_MODE | R/W&nbsp; | 0h&nbsp; | TaskSwap Mode</p><pre>0:  Disabled<br />1:  RXTX<br />2:  General_HW</pre><p>PEAK cycles: 5 cycle</p><p>Pseudo code:</p><pre>TEMP_REG.reg1.x = TM_BASE;<br />TEMP_REG.reg2.x = value;<br />memcpy(offset(TEMP_REG.reg2.x), TEMP_REG.reg1.x, <span class="SHNumber">2</span>);</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 2 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr><tr><td class="CDLEntry">value</td><td class="CDLDefinition"><p>Value to store in tasks_mgr_global_cfg_reg</p></td></tr></table></div>
</div>

<a name="m_pru_tm_rst"></a><a name="Topic25"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_rst</div>
 <div class="CBody"><p>Clears task manager status</p><p>PEAK cycles: 11 cycle</p><div class="CHeading">Invokes</div><p><a href="../../../index.html#File:firmware/common/icss_tm_macros.inc:m_pru_tasks_mgr_global_cfg_reg" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,24);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >m_pru_tasks_mgr_global_cfg_reg</a></p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 2 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr></table></div>
</div>

<a name="m_pru_tm_set_cfg_gpmode_enable"></a><a name="Topic26"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_set_cfg_gpmode_enable</div>
 <div class="CBody"><p>Task Manager CFG for PRU to setup TM in General Purpose Mode.</p><div class="CHeading">PeakCycles</div><p>5 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>2 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Write to PRU0_TM_GLOBAL_CFG <span class="SHKeyword">register</span> to <span class="SHKeyword">set</span> tasks_mgr_mode to <span class="SHNumber">2</span>.<br />Also enables all subtasks.</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 2 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_pc_set"></a><a name="Topic27"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_pc_set</div>
 <div class="CBody"><p>Task Manager set the PC value for given task.</p><div class="CHeading">PeakCycles</div><p>7 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>3 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Write ts_pc to <span class="SHKeyword">register for</span> ts_number.</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 3 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr><tr><td class="CDLEntry">ts_pc</td><td class="CDLDefinition"><p>Program counter value for task</p></td></tr><tr><td class="CDLEntry">ts_number</td><td class="CDLDefinition"><p>Task number (TS1_S0 to TS2_S4)</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_ts1_pc_set"></a><a name="Topic28"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_ts1_pc_set</div>
 <div class="CBody"><p>Task Manager set the PC values for TS1_S{0 to 4}</p><div class="CHeading">PeakCycles</div><p>14 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>4 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Write ts1_pc_s0 to TS1_PC_S0 <span class="SHKeyword">register</span><br />Write ts1_pc_s1 to TS1_PC_S1 <span class="SHKeyword">register</span><br />Write ts1_pc_s2 to TS1_PC_S2 <span class="SHKeyword">register</span><br />Write ts1_pc_s3 to TS1_PC_S3 <span class="SHKeyword">register</span><br />Write ts1_pc_s4 to TS1_PC_S4 <span class="SHKeyword">register</span></pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 4 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr><tr><td class="CDLEntry">ts1_pc_s0</td><td class="CDLDefinition"><p>Program counter value for TS1_S0</p></td></tr><tr><td class="CDLEntry">ts1_pc_s1</td><td class="CDLDefinition"><p>Program counter value for TS1_S1</p></td></tr><tr><td class="CDLEntry">ts1_pc_s2</td><td class="CDLDefinition"><p>Program counter value for TS1_S2</p></td></tr><tr><td class="CDLEntry">ts1_pc_s3</td><td class="CDLDefinition"><p>Program counter value for TS1_S3</p></td></tr><tr><td class="CDLEntry">ts1_pc_s4</td><td class="CDLDefinition"><p>Program counter value for TS1_S4</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_ts2_pc_set"></a><a name="Topic29"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_ts2_pc_set</div>
 <div class="CBody"><p>Task Manager set the PC values for TS2_S{0 to 4}</p><div class="CHeading">PeakCycles</div><p>14 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>4 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>TEMP_REG -&gt; Register Structure <span class="SHKeyword">with</span> atleast <span class="SHNumber">4</span> Registers<br />TM_BASE -&gt; Base address of the corresponding PRU<span class="SHString">'s task manager</span><br /><span class="SHString">Write ts2_pc_s0 to TS2_PC_S0 register</span><br /><span class="SHString">Write ts2_pc_s1 to TS2_PC_S1 register</span><br /><span class="SHString">Write ts2_pc_s2 to TS2_PC_S2 register</span><br /><span class="SHString">Write ts2_pc_s3 to TS2_PC_S3 register</span><br /><span class="SHString">Write ts2_pc_s4 to TS2_PC_S4 register</span></pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ts2_pc_s0</td><td class="CDLDefinition"><p>Program counter value for TS2_S0</p></td></tr><tr><td class="CDLEntry">ts2_pc_s1</td><td class="CDLDefinition"><p>Program counter value for TS2_S1</p></td></tr><tr><td class="CDLEntry">ts2_pc_s2</td><td class="CDLDefinition"><p>Program counter value for TS2_S2</p></td></tr><tr><td class="CDLEntry">ts2_pc_s3</td><td class="CDLDefinition"><p>Program counter value for TS2_S3</p></td></tr><tr><td class="CDLEntry">ts2_pc_s4</td><td class="CDLDefinition"><p>Program counter value for TS2_S4</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_disable_task"></a><a name="Topic30"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_disable_task</div>
 <div class="CBody"><p>Disable given task in Task Manager.</p><div class="CHeading">PeakCycles</div><p>8 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>3 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Disable given task (ts_number) <span class="SHKeyword">in</span> Task Manager.</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 3 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr><tr><td class="CDLEntry">ts_number</td><td class="CDLDefinition"><p>Task number (TS1_S0 to TS2_S4)</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_enable_task"></a><a name="Topic31"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_enable_task</div>
 <div class="CBody"><p>Enable given task in Task Manager.</p><div class="CHeading">PeakCycles</div><p>8 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>3 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Enable given task (ts_number) <span class="SHKeyword">in</span> Task Manager.</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TEMP_REG</td><td class="CDLDefinition"><p>Register Structure with atleast 3 Registers</p></td></tr><tr><td class="CDLEntry">TM_BASE</td><td class="CDLDefinition"><p>Base address of the corresponding PRU's task manager</p></td></tr><tr><td class="CDLEntry">ts_number</td><td class="CDLDefinition"><p>Task number (TS1_S0 to TS2_S4)</p></td></tr></table><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_set_cfg_gpmode_ts1_mux_set"></a><a name="Topic32"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_set_cfg_gpmode_ts1_mux_set</div>
 <div class="CBody"><p>Task Manager CFG for PRU to setup TM GP Mode Mux for TS1.</p><div class="CHeading">PeakCycles</div><p>11 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>3 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Write to TS1_GEN_CFG1 and TS1_GEN_CFG2 <span class="SHKeyword">register</span> to setup GP mode mux <span class="SHKeyword">for</span> TS1.</pre><div class="CHeading">Parameters</div><p>TEMP_REG -&gt; Register Structure with atleast 3 Registers</p><p>TM_BASE -&gt; Base address of the corresponding PRU's task manager</p><p>ts1_mx_s0 -&gt; Mux value for TS1_S0</p><p>ts1_mx_s1 -&gt; Mux value for TS1_S1</p><p>ts1_mx_s2 -&gt; Mux value for TS1_S2</p><p>ts1_mx_s3 -&gt; Mux value for TS1_S3</p><p>ts1_mx_s4 -&gt; Mux value for TS1_S4</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_set_cfg_gpmode_ts2_mux_set"></a><a name="Topic33"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_set_cfg_gpmode_ts2_mux_set</div>
 <div class="CBody"><p>Task Manager CFG for PRU to setup TM GP Mode Mux for TS2.</p><div class="CHeading">PeakCycles</div><p>11 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>3 Registers required in TEMP_REG defined by user</p><div class="CHeading">PseudoCode</div><pre>Write to TS2_GEN_CFG1 and TS2_GEN_CFG2 <span class="SHKeyword">register</span> to setup GP mode mux <span class="SHKeyword">for</span> TS2.</pre><div class="CHeading">Parameters</div><p>TEMP_REG -&gt; Register Structure with atleast 3 Registers</p><p>TM_BASE -&gt; Base address of the corresponding PRU's task manager</p><p>ts2_mx_s0 -&gt; Mux value for TS1_S0</p><p>ts2_mx_s1 -&gt; Mux value for TS1_S1</p><p>ts2_mx_s2 -&gt; Mux value for TS1_S2</p><p>ts2_mx_s3 -&gt; Mux value for TS1_S3</p><p>ts2_mx_s4 -&gt; Mux value for TS1_S4</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_yield"></a><a name="Topic34"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_yield</div>
 <div class="CBody"><p>Current Task yield to Task Manager</p><div class="CHeading">PeakCycles</div><p>4 cycles</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>R0.b3</p><div class="CHeading">PseudoCode</div><pre>xin to TM_YIELD_XID <span class="SHKeyword">with</span> <span class="SHNumber">1</span> <span class="SHKeyword">byte</span></pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_yield_only"></a><a name="Topic35"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_yield_only</div>
 <div class="CBody"><p>Current Task yield to Task Manager</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>R0.b3</p><div class="CHeading">PseudoCode</div><pre>xin to TM_YIELD_XID <span class="SHKeyword">with</span> <span class="SHNumber">1</span> <span class="SHKeyword">byte</span></pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_yield_self_loop"></a><a name="Topic36"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_yield_self_loop</div>
 <div class="CBody"><p>Deadloop during Task yield to Task Manager</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>None</p><div class="CHeading">PseudoCode</div><pre>Deadloop.</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_enable"></a><a name="Topic37"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_enable</div>
 <div class="CBody"><p>Task Manager enable</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>None</p><div class="CHeading">PseudoCode</div><pre>A <span class="SHKeyword">new</span> instruction <span class="SHString">&quot;TSEN 1&quot;</span> is defined <span class="SHKeyword">for</span> Task Manager Enable<br />Using .word as a workaround because CLPRU doesnt support TSEN instruction</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_disable"></a><a name="Topic38"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_disable</div>
 <div class="CBody"><p>Task Manager disable</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>None</p><div class="CHeading">PseudoCode</div><pre>A <span class="SHKeyword">new</span> instruction <span class="SHString">&quot;TSEN 0&quot;</span> is defined <span class="SHKeyword">for</span> Task Manager Disable<br />Using .word as a workaround because CLPRU doesnt support TSEN instruction</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_context_save"></a><a name="Topic39"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_context_save</div>
 <div class="CBody"><p>Save previous task's context (R0-R29) to Scratch PAD.</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>R0</p><div class="CHeading">PseudoCode</div><pre>xout to TM_SAVE_XID <span class="SHKeyword">with</span> <span class="SHNumber">120</span> bytes</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_context_restore"></a><a name="Topic40"></a><div class="CTopic TMacro LAssembly">
 <div class="CTitle">m_pru_tm_context_restore</div>
 <div class="CBody"><p>Restore previous task's context (R0-R29) to Scratch PAD.</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>R0</p><div class="CHeading">PseudoCode</div><pre>xin <span class="SHNumber">120</span> bytes from TM_SAVE_XID SPAD bank</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

<a name="m_pru_tm_context_swap"></a><a name="Topic41"></a><div class="CTopic TMacro LAssembly last">
 <div class="CTitle">m_pru_tm_context_swap</div>
 <div class="CBody"><p>Save previous task's context (R0-R29) to Scratch PAD and restore current task's context.</p><div class="CHeading">PeakCycles</div><p>1 cycle</p><div class="CHeading">Invokes</div><p>None</p><div class="CHeading">Registers</div><p>R0</p><div class="CHeading">PseudoCode</div><pre>xchg to TM_SAVE_XID <span class="SHKeyword">with</span> <span class="SHNumber">120</span> bytes</pre><div class="CHeading">Parameters</div><p>None</p><div class="CHeading">Returns</div><p>None</p><div class="CHeading">See Also</div></div>
</div>

</body></html>